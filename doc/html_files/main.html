<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="./common.css" />
</head>
<body>
    <a name="_top">
        本ツールは上海アリス幻樂団の弾幕系シューティング東方Projectのみ(同じエンジンを使っている呑んべぇ会の黄昏酒場も含む)に向けたものです。ほかのゲーム(萃夢想、緋想天、非想天則を含む)は動作確認を行っておりません。<br />
        また、開発ツール(Visual Studio 2010)の関係で、Windows 2000以前のOSは未対応です。
    </a>
    <h1><a name="_supported_works">対応作品</a></h1>
    <p>
        本ツールにはDirect3D 8版と、Direct3D 9版の２つがあり、それぞれ対応作品が異なります。<br />
        それぞれの対応作品は以下のとおり(サブタイトル略)になりますが、レイアウト、プレイ時かどうかの判定条件等については各自でカスタマイズ可能なため、
        今後の作品にも対応できるかもしれません。
        <table border="1">
            <tr>
                <td>Direct3D 8版</td>
                <td>Direct3D 9版</td>
            </tr>
            <tr>
                <td>
                    東方紅魔郷<br />
                    東方妖々夢<br />
                    東方永夜抄<br />
                    東方花映塚(※)<br />
                    東方文花帖
                </td>
                <td>
                    東方風神録<br />
                    東方地霊殿<br />
                    東方星蓮船<br />
                    ダブルスポイラー<br />
                    妖精大戦争<br />
                    東方神霊廟<br />
                    東方輝針城 (体験版のみ確認)<br />
                    弾幕アマノジャク<br />
                    東方紺珠伝 (体験版のみ確認)<br />
                    黄昏酒場
                </td>
            </tr>
        </table>
        ※　デフォルトでの設定では、ただ画面を回転させるだけになります。<br /><br />
        動作確認環境1<br />
        OS：Windows 10 Pro 64bit<br />
        CPU：Intel Core i7 4790<br />
        グラフィック：NVIDIA GeForce GTX 960<br />
    </p>
    <h1><a name="_feature_summary">主な機能</a></h1>
    <p>
        <ul>
            <li>
                ゲーム起動中にAlt+左右キーで、画面をそれぞれ左回転、右回転することができます。
            </li>
            <li>
                さらに、ゲームプレイ状態と判定されると、プレイ領域を画面に合わせて目一杯に拡大します。
                ウィンドウモードでも使えるので、生放送をする人にも便利かもしれません。
            </li>
            <li>
                拡大時のスコアや残機、ボムなどの表示レイアウトは、デフォルトのものが気に入らなければ各自でカスタマイズ可能です。
            </li>
            <li>
                紅魔郷には画面をファイルに保存する機能は標準では搭載されていませんが、妖々夢と同じ方法(Homeキー)で画面を保存することができます。
            </li>
            <li>
                地霊殿以降の作品では、ウィンドウモード(960x720か1280x960)で起動すると、通常ではピクセルの色補間機能がうまく働かずにカクカクになってしまいますが、
                本ツールをインストールすることで、バイリニア補間によるなめらかな表示ができます(補間しないオプションもあります)。
            </li>
        </ul>
    </p>
    <h1><a name="_installation">インストール方法</a></h1>
    <ol>
        <li>
            インストール先の作品が<br />
            東方紅魔郷<br />
            東方妖々夢<br />
            東方永夜抄<br />
            東方花映塚<br />
            東方文花帖<br />
            の場合は、<font color="red">d3d8.dll</font>を、<br />
            東方風神録<br />
            東方地霊殿<br />
            東方星蓮船<br />
            ダブルスポイラー<br />
            妖精大戦争<br />
            東方神霊廟<br />
            東方輝針城<br />
            弾幕アマノジャク<br />
            東方紺珠伝<br />
            黄昏酒場<br />
            の場合は、<font color="red">d3d9.dll</font>を<font color="red">インストールディレクトリ</font>(exeがあるところ)にコピー＆ペーストしてください。管理者権限が必要なら、管理者権限で行ってください。
        </li>
        <li>
            次に作品名に対応した設定ファイル<font color="red">throt_<作品名>.ini</font>を、次のディレクトリにコピーし、コピー先でそれを<font color="red">throt.ini</font>にリネームします。
            <ul>
                <li>紅魔郷、妖々夢、永夜抄、花映塚、文花帖、風神録、地霊殿、星蓮船、黄昏酒場の場合：<br /><font color="red">インストールディレクトリ</font></li>
                <li>
                    ダブルスポイラー、妖精大戦争、東方神霊廟体験版の場合：
                    <ul>
                        <li>OSがWindows XPの場合：<br /><font color="red">C:\Documents and Settings\&lt;ログインユーザ名&gt;\Application Data\ShanghaiAlice\th&lt;作品ナンバリング&gt;\</font></li>
                        <li>OSがWindows Vista/7の場合：<br /><font color="red">C:\Users\&lt;ログインユーザ名&gt;\AppData\Roaming\ShanghaiAlice\th&lt;作品ナンバリング&gt;\</font></li>
                        <li>
                            次のようなインストールディレクトリと同じ場所にセーブするためのバッチファイルを使って東方を起動している場合：<font color="red">インストールディレクトリ</font>
                            <table border="1">
                                <tr>
                                    <td>
                                        set APPDATA=<br />
                                        start 実行ファイル名
                                    </td>
                                </tr>
                            </table>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
    </ol>
    <h1><a name="_usage">使い方</a></h1>
    <h2><a name="_usage_rotation">画面の回転</a></h2>
    <p>
        Alt+左右キーを押すことで、それぞれ左方向、右方向に90度ずつ回転します。また、プレイ時またはリプレイ再生時に、回転された画面から見てアスペクト比が4:3より小さくなると、
        プレイ領域を画面目一杯に拡大します。
    </p>
    <h2><a name="_usage_th7_capture">東方紅魔郷でのスクリーンキャプチャ</a></h2>
    <p>
        東方紅魔郷にはスクリーンキャプチャが存在しませんが、THRotatorを使うことでスクリーンキャプチャを保存できるようになります。
        保存先は、星蓮船までの作品と同じく、インストールディレクトリ以下のsnapshotフォルダです。
    </p>
    <h2><a name="_usage_customization">カスタマイズ</a></h2>
    <p>
        ウィンドウモードでタイトルバーを右クリックすると、メニューの1番下に"THRotatorを表示"があるので、それをクリックします。すると、次のような画面が表示されます。<br />
        Direct3D 9版はこのウィンドウを表示中でもゲームが進行しますが、Direct3D 8版はこの画面が出ている間はゲームが停止します。<br />
        <img src="custom.png">
        <ol>
            <li>
                本ツールでは、現在プレイ中またはリプレイ再生中かどうかを判定するためのパラメータとして、1フレームあたりのVP(=ビューポート)設定回数の閾値を用います。
                VP設定回数は、メニュー表示時などの非プレイ時にくらべて、プレイ時やリプレイ再生時のほうが多いです。VP設定回数取得ボタンで、1フレーム間の実際のVP設定回数を取得できるので、
                回数閾値の欄に非プレイ時のVP設定回数よりも大きく、プレイ時のVP設定回数以下の値を入力すれば、縦画面化のレイアウトを使ったほうが大きく表示できると判断された場合に限り、
                縦画面用のレイアウトになります。<br />
                throt.iniが読み込めない場合は、デフォルトで回数閾値は999になります。実際にはそこまでの回数で設定することはありえないので、この値はプレイ中かどうかの判定は必ず偽になることを意味します。
            </li>
            <li>
                プレイ画面の矩形の位置、大きさを指定します(下図青枠の部分)。ここで指定した矩形が画面いっぱいにアスペクト比を保存しながら拡大され、画面の中央に配置されます。通常は(左,上,幅,高さ)=(32,16,384,448)、文花帖や妖精大戦争のように真ん中に配置されている場合は(128,16,384,448)です。
                しかし、ここで指定した矩形は実際のプレイ領域と同じである必要はなく、妖精大戦争と黄昏酒場のデフォルトレイアウトのように、広めに取ることができます。<br />
                オフセットは画面が拡大された後にどれだけy方向に移動させるかを指定します。<br /><img src="pr.png">
            </li>
            <li>　画面の回転はAlt+左右キーですることができますが、この画面でも回転角を指定することができます。</li>
            <li>　画像の拡大が行われた時の補間方法を指定します。throt.iniが見つからない場合は、デフォルトでバイリニアになります。</li>
            <li>　ウィンドウモード時にチェックを入れておくと、ウィンドウの幅と高さを交換して縦長になります。</li>
            <li>
                起動時にTHRotatorの画面を出すかどうかを指定します。throt.iniが見つからない場合はデフォルトで表示しません。<br />
                なお、このオプションはDirect3D 8版にはありません。
            </li>
            <li>
                プレイ領域以外の矩形の転送元矩形、転送先矩形の位置、大きさを指定します。追加、またはリストから矩形を選択して編集すると矩形編集画面が表示されます。矩形の転送は上から順番に行われるため、
                リストの一番下にある矩形が最も上に描画されるということになります。ちなみに、転送先の座標系は、プレイ領域のサイズをアスペクト比3:4に合わせた幅と高さをWp,Hpとして、次のようになります。
                <br /><img src="cs.png"><br />
                また、ver. 1.01から拡大して余った黒帯の領域にも矩形の転送ができるようになりました。
            </li>
            <li>　右上の閉じるボタンと同じくTHRotatorの画面を閉じます。</li>
            <li>　最後に適用を押したときの状態に、フォームへの入力を戻します。</li>
            <li>　この画面で入力されたパラメータを実際に反映させます。このボタンを押したタイミングで設定ファイルthrot.iniが保存されます。</li>
        </ol>
        以上長々と説明しましたが、パラメータを実際に変えてみて、どのようになるかを見たほうが、理解しやすいかもしれません。
        新作への対応の要領ですが、だいたい次のようになります。
        <ol>
            <li>　非プレイ時とプレイ時のVP設定回数を取得して、非プレイ時よりも大きく、プレイ時以下の値を回数閾値に入力する。</li>
            <li>　プレイ画面領域の位置とサイズを入力する。</li>
            <li>　スコアなどの情報を表示するために、その他領域に矩形を追加する。</li>
        </ol>
    </p>
    <h1><a name="_default_layout">画面拡大時のデフォルトレイアウト</a></h1>

    <p>下記の作品では、表示桁数等を確保するために、一部のHUD要素のアスペクト比が保存されていません。</p>
    <ol>
        <li>東方永夜抄　～ Imperishable Night. (数値の桁をすべて表示するため)</li>
        <li>東方文花帖　～ Shoot the Bullet. (数値の桁をすべて表示するため)</li>
        <li>ダブルスポイラー　～ 東方文花帖 (数値の桁をすべて表示するため)</li>
        <li>妖精大戦争　～ 東方三月精 (パーフェクトフリーズの文字はすべて表示するため)</li>
    </ol>
    <h1><a name="_uninstall">アンインストール方法</a></h1>

    ただ単に本ツールの機能を無効化させたいだけなら、d3d9.dll.bakのように、d3d9.dllまたはd3d8.dllを別の名前に変えればできます。
    もし完全に削除したいのなら、d3d9.dllまたはd3d8.dllとthrot.iniを削除してください。
    <h1><a name="_troubleshoot">トラブルシューティング</a></h1>
    <p>
        <ul>
            <li>
                Alt+左右キーを押しても画面が回転しない
            </li>
            <li>
                ウィンドウモードでタイトルバーを右クリックしても「THRotatorを表示」がない
            </li>
            <li>
                ウィンドウモードの解像度に960×720または1280×960を指定したときに表示がなめらかにならない
                <ul>
                    <li>
                        d3d8.dllまたはd3d9.dllがコピーされているかどうかをご確認ください。
                        コピーしても動かない場合はDirect3D 8版の作品にd3d9.dllをコピーしたり、その逆をしていないかご確認ください。
                        もう一度インストール方法を確認して、画面を回転したい作品が、Direct3D 8版とDirect3D 9版のどちらを必要とするのかを確かめてください。
                        <br /><br />
                    </li>
                </ul>
            </li>
            <li>縦画面用のレイアウトになるべきところで縦画面用のレイアウトにならない</li>
            <li>スコアや残機などの情報が表示されない</li>
            <li>
                東方文花帖、妖精大戦争、ダブルスポイラーで縦画面用のレイアウトがずれている
                <ul>
                    <li>
                        作品に対応した設定ファイルをコピーしてあるかどうかをご確認ください。
                        また、コピー先に間違いがないかをご確認ください。
                        ダブルスポイラー以降の作品はコピー先を間違えやすいと思いますが、インストール方法をもう一度確認してみてください。
                    </li>
                </ul>
            </li>
        </ul>
    </p>
    <h1><a name="_known_issues">既知の問題</a></h1>
    <p>
        東方紺珠伝をフルスクリーンで起動すると、スクリーン全体が黒画面と何度も行き来する現象を確認しています。
        しばらくするとタイトル画面に遷移し、通常通りゲームを進行可能です。
    </p>
    <h1><a name="_additional_notes">注意事項</a></h1>
    <p>
        <ul>
            <li>本ツールの使用は自己責任でお願いします。</li>
            <li>
                本ツールはソフトウェアに仕様外の動作を行わせるツールです。
                したがって、本ツールを利用して達成したスコアやリプレイは正式なものとして認められない可能性があります。
                もし気になるなら、スコアアタック大会の主催者に確認したり、リプレイをアップロードする際には本ツール使用の旨をコメントを加えたりすると良いと思います。
            </li>
            <li>本ツールに含まれているd3d8.dllとd3d9.dllは、絶対にシステムディレクトリにコピーしないでください。</li>
            <li>本ツールを対応作品以外に使った時の動作は未定義です。</li>
        </ul>
    </p>
    <h1><a name="_release_notes">リリースノート</a></h1>
    <h2>2017/5/? Ver. 1.2.0</h2>
    <p>
        機能追加：
        <ul>
            <li>東方紅魔郷でホームキーを押せば、スクリーンショットをインストールディレクトリ以下のsnapshotフォルダに保存できるようにしました。</li>
        </ul>
    </p>
    <p>
        バグ修正：
        <ul>
            <li>東方紺珠伝で画面が黒くなる現象を修正しました。</li>
            <li>960x720、1280x960の解像度に対応しました。</li>
        </ul>
    </p>
    <p>
        その他：
        <ul>
            <li>
                throt.iniのファイル入出力を高速化しました。
            </li>
            <li>
                バージョンの増え方を変更しました。
                今後は<a href="http://semver.org/" target="_blank">Semantic Versioning 2.0</a>に従い増やしていきますが、
                THRotatorはAPIを提供しないため、APIを設定ファイルなどのデータと置き換えて解釈してください。
            </li>
        </ul>
    </p>
    <h2> 2011/8/18 Ver. 1.01</h2>
    <p>
        アスペクト比固定拡大機能追加
    </p>
    <h2>2011/8/16</h2>
    <p>
        神霊廟デフォルトレイアウトの修正
    </p>
    <h2>2011/8/14 Ver 1.00</h2>
    <p>
        初版
    </p>
    <h1><a name="_contacts">奥付</a></h1>
    <p>
        作者: massanoori<br />
        ソースコード: <a target="_blank" href="https://github.com/massanoori/THRotator">GitHub</a>
    </p>
</body>
</html>
